# OneChance合约测试-html

以下以windows环境为例

启动cmd,并将目录修改为当前目录(geth-test)后

执行以下命令启动geth控制台
  
1. geth --datadir "./privatenet" init ./privatenet/genesis.json 2>>oneChance.log
   // 使用 genesis.json 文件初始化区块链,该文件为测试用3个用户分配了部分 Ether
2. geth --rpc --rpcapi "db,eth,net,web3,personal" --rpcport "8080" --rpccorsdomain "*" --datadir "./privatenet" --port "30303" --identity "Sun" console 2>>oneChance.log
   // 在私有链上启动geth控制台,并且开启rpcapi中的personal选项以支持在页面中解锁账户
   // 注意这里的启动参数--rpcport如果非8080，或者以太坊节点非本机，需要修改init.js文件的serviceAddress属性配置以太坊节点访问地址
3. miner.start(1);
   // 启动挖矿,已使web页面的合约操作生效

测试环境初始有3个账户,账户密码都是"test123456",账户解锁操作都在js中自动进行

建议使用本目录提供的privatenet/genesis.json配置创建私有链，因为demo中的密码都是写死在js中，省略了密码输入步骤，如果更换其他私链用户可能无法使用

可以在init.js文件中修改accountsPassword变量值来配置账户密码，但是目前demo的设计所有用户密码都相同，不支持不同账户不同密码配置

以太坊节点启动，并且挖矿开始运行后，打开index.html页面测试即可，步骤如下

1. 在系统状态页面，点击一键部署按钮，完成合约部署、合约地址设置操作
   // 按钮点击后，页面通过js自动发送操作请求到以太坊节点，需要等待挖矿成功以确认交易
   // 等待过程中请不要进行其它操作，直到右上角提示条提示合约地址设置成功，在合约状态中能看到所有地址信息都不为0后，才可以继续下一步
2. 在主办方界面发布奖品、发行代币
   // 请最少发布一个奖品、给最少一个用户发行一定量ChaneCoin代币，操作执行成功后右上侧会有提示通知
   // 奖品发布成功后最新奖品编号会自动更新
   // 代币发行成功后系统状态页面用户账户余额会自动更新
3. 在用户界面查询奖品信息，购买奖品Chance，查询奖品购买用户信息
   // 使用奖品编号可以查询奖品信息，奖品金额-已购买用户数 可以得到奖品可购买Chance数量
   // 购买Chance界面可以购买奖品，密码输入步骤已省略，购买地址只能从当前节点已有用户中选择，请注意不要填错奖品编号
   // 随机数种子为必填项
   // 购买Chance成功后会有提示框通知
   // 当某个奖品全部Chance售罄后，会通知用户提交随机数种子，随机数种子的记录和提交由js自动完成，对用户透明
   // 随机数种子集齐后合约自动开奖，开奖结果会通知给所有用户，用户可以使用奖品信息查询查看中奖用户信息
   // 奖品购买用户查询可以查看购买奖品的所有用户以及随机数种子信息，用户可以手工验证中奖结果(虽然读过源码的情况下手工验证并没有必要)
   // 发送代币功能可以将ChanceCoin在用户间转移
   
ps. 按钮点击后到旷工挖矿成功确认之间有延时，需要耐心等待，请不要重复点击，交易确认后页面右上侧会弹出提示框通知
